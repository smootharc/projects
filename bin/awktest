#!/bin/bash


gcalcli --tsv --calendar Medical search " " | awk -v medication="$1" -v starttime="$2" -v endtime="$3" '

function date2s( date, time)
{
    gsub(/-/, " ", date)
    gsub(/:/, " ", time)
    return( date " " time " " 0 )
}

BEGIN {

print "Arg Count: " ARGC
print "Arg Zero: " ARGV[0]
print medication
print starttime
print endtime

}

$0 ~ medication && !/00:00/ {

doses++
printf "%4d %s \n", doses, $0
if (doses == 1) {
    startdate = $1
    starttime = $2
    }
}

END {


endseconds = systime()
#endseconds = mktime( date2s( $1, $4 ) )
startseconds = mktime( date2s( startdate, starttime ) )
elapsedseconds = endseconds - startseconds
days = elapsedseconds / 86400
dosesperday = doses / days

print "   Medication: " Medication
print "   First Dose: " startdate " " starttime
print "    Last Dose: " $1 " " $4
print "Date Time Now: " strftime("%Y-%m-%d %H:%M", endseconds)
print "        Doses: " doses
print " Elapsed Days: " days
print "    Doses/Day: " dosesperday
}

'
